pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
bs=1
ps=19
px=64
py=100
maxlevel=10
scorepadding=12

fruits={}
fruit_start=16
fruit_end=25
fruit_count=9
fruit_interval=16

gravity=1



function _init()
 level=1
 points=0
 basket={}
 for i=fruit_start,fruit_end do
  add(basket,{sp=i,score=0})
 end
 
  init_level()
  _update=update_game
  _draw=draw_game

end

function init_level()
  for i=1,level do
  fruit={
   sprite=flr(rnd(fruit_end-fruit_start+1)+fruit_start),
   x=flr(rnd(110)+5),
   y=i*(-fruit_interval)
  }
 --if fruit.sprite==19 then fruit.sprite=2 end
 add(fruits,fruit)
 end 
end


function _update()
 
 
end

function update_gameover()
 if btn(❎) then _init() end
end

function update_game()
 if btn(⬅️) then px-=2 end
 if btn(➡️) then px+=2 end
 
 px=mid(0,120,px)
 
 for fruit in all(fruits) do
  fruit.y+=gravity
  
  if fruit.y+4>py-8
  and fruit.y+4<py
  and fruit.x+4>px
  and fruit.x+4<px+8 then
   points+=1
   ps=fruit.sprite
   sfx(0)
   for s in all (basket) do
    if s.sp==fruit.sprite then s.score+=1 end
   end
   del(fruits,fruit)
  end
  
  if fruit.y>100 then
   del(fruits,fruit)
  end
 end
 
 if #fruits==0 then
  level+=1
  if level>maxlevel then
   _update=update_gameover
   _draw=draw_gameover
  else
   init_level()
  end
 end
end

function _draw()

end

function draw_gameover()
 ps=2
 draw_play_area()
 print("congratulations",30,60,7)
 print("press ❎ to play again",20,70,7)
end


function draw_game()
 draw_play_area()
 print("level "..level,2,2,7)
end

function draw_play_area()
  cls()
 rectfill(0,108,127,127,3)
 spr(ps,px,py)
 spr(bs,px,py-8)
 for fruit in all(fruits) do
  spr(fruit.sprite,fruit.x,fruit.y)
 end 
 
 --print("score="..points)
 lpad=6
 for s in all (basket) do
  --{sprnum,score}
  spr(s.sp,lpad,110)
  print(s.score,lpad+1,122,7)
  lpad+=scorepadding
 end
end
__gfx__
00000000066666604055550400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000064044440400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700677777754044440400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000660606059994499900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000606060d50099990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070066060d0500cccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000060d0d05500c00c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055555500dd00dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00d43b000000090000b0b0b00000b300000000b0000000000b0000005bb3b3504055550477777777000000000000000000000000000000000000000000000000
00bb03b000000a40000bbb00000b3300000008730099b30033900000b3b533304044440476767677000000000000000000000000000000000000000000000000
0b7bb00000000a4000f9a900088338800000857b099b3880099a0000353335304044440476777667000000000000000000000000000000000000000000000000
0b7bb0000000a9400f9a9a4088e888880008887b97a999880049a000335333339994499977767767000000000000000000000000000000000000000000000000
b7bbb300000a940009a9a4908e7e88820085857b9a999988000499003533b5350099990077777777000000000000000000000000000000000000000000000000
bbbbb3000aa940000a9a494088e88882088887b399999988000009a03335b33300cccc0000066600000000000000000000000000000000000000000000000000
3bbbb3000994000009a4949008888820b7777b30099998800000009a0003b00000c00c0000066600000000000000000000000000000000000000000000000000
0333300000000000004949000222220003bbb3000088880000000000000bb0000dd00dd000066600000000000000000000000000000000000000000000000000
__sfx__
000200000d72013720197201f72027720317203770025700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700
